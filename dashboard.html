<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VieMoney ğŸ’° - Quáº£n lÃ½ chi tiÃªu cÃ¡ nhÃ¢n</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2590/2590670.png">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f8fafc;
    }
    .card {
      background-color: white;
      border-radius: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 1rem;
      transition: all 0.3s ease;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }
    .btn {
      border-radius: 1rem;
      padding: 0.6rem 1rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    .btn:hover { opacity: 0.9; }
    .active-tab {
      background: linear-gradient(to right, #34d399, #10b981);
      color: white;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col justify-between">

  <!-- HEADER -->
  <header class="text-center py-4 shadow bg-white sticky top-0 z-50">
    <h1 class="text-2xl font-bold text-emerald-600">ğŸ’° VieMoney</h1>
    <p class="text-gray-500 text-sm">Quáº£n lÃ½ chi tiÃªu cÃ¡ nhÃ¢n thÃ´ng minh</p>
  </header>

  <!-- TAB CHá»ŒN THU / CHI -->
  <div class="flex justify-center gap-4 mt-6">
    <button id="tabIncome" class="btn bg-emerald-100 text-emerald-700 w-32">Thu nháº­p</button>
    <button id="tabExpense" class="btn bg-red-100 text-red-700 w-32">Chi tiÃªu</button>
  </div>

  <!-- FORM NHáº¬P -->
  <section id="formSection" class="max-w-md mx-auto mt-6 px-4">
    <div class="card space-y-4">
      <div>
        <label class="font-semibold text-gray-700 block mb-2">Chá»n má»¥c</label>
        <div id="categoryContainer" class="grid grid-cols-2 gap-2"></div>
      </div>

      <div>
        <label class="font-semibold text-gray-700 block mb-1">Sá»‘ tiá»n (VNÄ)</label>
        <input id="amountInput" type="number" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-emerald-400" placeholder="Nháº­p sá»‘ tiá»n...">
      </div>

      <div>
        <label class="font-semibold text-gray-700 block mb-1">Ghi chÃº</label>
        <input id="noteInput" type="text" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-emerald-400" placeholder="VÃ­ dá»¥: LÆ°Æ¡ng thÃ¡ng 11...">
      </div>

      <div>
        <label class="font-semibold text-gray-700 block mb-1">NgÃ y</label>
        <input id="dateInput" type="date" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-emerald-400">
      </div>

      <button id="saveBtn" class="btn w-full bg-emerald-500 text-white mt-4">ğŸ’¾ LÆ°u giao dá»‹ch</button>
    </div>
  </section>

  <!-- DASHBOARD -->
  <section id="dashboard" class="max-w-2xl mx-auto mt-8 px-4">
    <div class="grid md:grid-cols-3 gap-4">
      <div class="card text-center">
        <h3 class="text-gray-500 text-sm">Tá»•ng thu</h3>
        <p id="totalIncome" class="text-2xl font-bold text-emerald-600">0â‚«</p>
      </div>
      <div class="card text-center">
        <h3 class="text-gray-500 text-sm">Tá»•ng chi</h3>
        <p id="totalExpense" class="text-2xl font-bold text-red-600">0â‚«</p>
      </div>
      <div class="card text-center">
        <h3 class="text-gray-500 text-sm">CÃ²n láº¡i</h3>
        <p id="totalBalance" class="text-2xl font-bold text-gray-800">0â‚«</p>
      </div>
    </div>

    <div class="card mt-6">
      <canvas id="financeChart" height="150"></canvas>
    </div>
  </section>

  <!-- DANH SÃCH GIAO Dá»ŠCH -->
  <section class="max-w-2xl mx-auto mt-6 px-4">
    <h2 class="font-bold text-lg mb-2">ğŸ“‹ Giao dá»‹ch gáº§n Ä‘Ã¢y</h2>
    <ul id="transactionList" class="space-y-2"></ul>
  </section>

  <!-- TOOLBAR DÆ¯á»šI CÃ™NG -->
  <footer class="fixed bottom-0 left-0 right-0 bg-white border-t shadow-inner py-2 flex justify-around items-center">
    <button id="ocrBtn" class="text-gray-700 flex flex-col items-center">
      ğŸ“¸ <span class="text-xs">HÃ³a Ä‘Æ¡n</span>
    </button>
    <button id="exportBtn" class="text-gray-700 flex flex-col items-center">
      ğŸ“‚ <span class="text-xs">Xuáº¥t file</span>
    </button>
    <button id="larkBtn" class="text-gray-700 flex flex-col items-center">
      ğŸ’¬ <span class="text-xs">BÃ¡o cÃ¡o</span>
    </button>
  </footer>
  <!-- SCRIPT -->
  <!-- Firebase -->
  <script type="module">
    // Firebase cáº¥u hÃ¬nh (mÃ y thay config cá»§a project tháº­t nhÃ©)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDinh-Quan-Demo",
      authDomain: "viemoney-app.firebaseapp.com",
      projectId: "viemoney-app",
      storageBucket: "viemoney-app.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:demo"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ==== DATA & UI ====
    let currentTab = "income";
    const incomeCategories = ["LÆ°Æ¡ng", "ThÆ°á»Ÿng", "Äáº§u tÆ°", "KhÃ¡c"];
    const expenseCategories = ["Ä‚n uá»‘ng", "Mua sáº¯m", "Äi láº¡i", "Giáº£i trÃ­", "HÃ³a Ä‘Æ¡n", "KhÃ¡c"];
    const transactions = [];

    // DOM
    const tabIncome = document.getElementById("tabIncome");
    const tabExpense = document.getElementById("tabExpense");
    const categoryContainer = document.getElementById("categoryContainer");
    const saveBtn = document.getElementById("saveBtn");
    const transactionList = document.getElementById("transactionList");
    const totalIncomeEl = document.getElementById("totalIncome");
    const totalExpenseEl = document.getElementById("totalExpense");
    const totalBalanceEl = document.getElementById("totalBalance");
    const larkBtn = document.getElementById("larkBtn");
    const exportBtn = document.getElementById("exportBtn");
    const ocrBtn = document.getElementById("ocrBtn");

    // ==== CHUYá»‚N TAB ====
    function renderCategories() {
      categoryContainer.innerHTML = "";
      const cats = currentTab === "income" ? incomeCategories : expenseCategories;
      cats.forEach(c => {
        const btn = document.createElement("button");
        btn.textContent = c;
        btn.className = "btn border w-full text-sm";
        btn.onclick = () => {
          document.querySelectorAll("#categoryContainer button").forEach(b => b.classList.remove("active-tab"));
          btn.classList.add("active-tab");
          btn.dataset.selected = c;
        };
        categoryContainer.appendChild(btn);
      });
    }

    tabIncome.onclick = () => {
      currentTab = "income";
      tabIncome.classList.add("bg-emerald-500", "text-white");
      tabExpense.classList.remove("bg-red-500", "text-white");
      renderCategories();
    };

    tabExpense.onclick = () => {
      currentTab = "expense";
      tabExpense.classList.add("bg-red-500", "text-white");
      tabIncome.classList.remove("bg-emerald-500", "text-white");
      renderCategories();
    };

    renderCategories();

    // ==== LÆ¯U GIAO Dá»ŠCH ====
    saveBtn.onclick = async () => {
      const categoryBtn = document.querySelector("#categoryContainer .active-tab");
      const category = categoryBtn ? categoryBtn.textContent : "KhÃ´ng chá»n";
      const amount = Number(document.getElementById("amountInput").value);
      const note = document.getElementById("noteInput").value || "";
      const date = document.getElementById("dateInput").value || new Date().toISOString().split("T")[0];

      if (!amount || amount <= 0) {
        alert("â— Nháº­p sá»‘ tiá»n há»£p lá»‡!");
        return;
      }

      const transaction = { type: currentTab, category, amount, note, date };
      transactions.push(transaction);

      await addDoc(collection(db, "transactions"), transaction);
      renderTransactions();
      updateTotals();

      // Reset form
      document.getElementById("amountInput").value = "";
      document.getElementById("noteInput").value = "";
    };

    // ==== HIá»‚N THá»Š DANH SÃCH ====
    function renderTransactions() {
      transactionList.innerHTML = "";
      transactions.slice().reverse().forEach(t => {
        const li = document.createElement("li");
        li.className = "card flex justify-between items-center text-sm";
        li.innerHTML = `
          <div>
            <span class="font-semibold ${t.type === "income" ? "text-emerald-600" : "text-red-600"}">${t.category}</span><br>
            <span class="text-gray-500">${t.note}</span>
          </div>
          <div class="text-right">
            <span class="${t.type === "income" ? "text-emerald-600" : "text-red-600"} font-bold">
              ${t.type === "income" ? "+" : "-"}${t.amount.toLocaleString()}â‚«
            </span><br>
            <span class="text-gray-400 text-xs">${t.date}</span>
          </div>`;
        transactionList.appendChild(li);
      });
    }

    // ==== Cáº¬P NHáº¬T Tá»”NG ====
    function updateTotals() {
      const income = transactions.filter(t => t.type === "income").reduce((sum, t) => sum + t.amount, 0);
      const expense = transactions.filter(t => t.type === "expense").reduce((sum, t) => sum + t.amount, 0);
      const balance = income - expense;
      totalIncomeEl.textContent = income.toLocaleString() + "â‚«";
      totalExpenseEl.textContent = expense.toLocaleString() + "â‚«";
      totalBalanceEl.textContent = balance.toLocaleString() + "â‚«";
      updateChart(income, expense);
    }

    // ==== BIá»‚U Äá»’ ====
    let chart;
    function updateChart(income, expense) {
      const ctx = document.getElementById("financeChart");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: ["Thu nháº­p", "Chi tiÃªu"],
          datasets: [{
            data: [income, expense],
            backgroundColor: ["#10b981", "#ef4444"]
          }]
        },
        options: {
          plugins: { legend: { position: "bottom" } }
        }
      });
    }

    // ==== Gá»¬I LARK ====
    larkBtn.onclick = async () => {
      const totalIncome = totalIncomeEl.textContent;
      const totalExpense = totalExpenseEl.textContent;
      const totalBalance = totalBalanceEl.textContent;
      const report = `ğŸ’° *BÃ¡o cÃ¡o VieMoney*\nTá»•ng thu: ${totalIncome}\nTá»•ng chi: ${totalExpense}\nCÃ²n láº¡i: ${totalBalance}`;
      await fetch("https://open.larksuite.com/webhook/demo", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ msg_type: "text", content: { text: report } })
      });
      alert("âœ… ÄÃ£ gá»­i bÃ¡o cÃ¡o lÃªn Lark!");
    };

    // ==== OCR ====
    ocrBtn.onclick = async () => {
      const fileInput = document.createElement("input");
      fileInput.type = "file";
      fileInput.accept = "image/*";
      fileInput.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const { createWorker } = Tesseract;
        const worker = await createWorker("eng");
        const { data: { text } } = await worker.recognize(file);
        alert("ğŸ“„ OCR káº¿t quáº£:\n" + text);
        await worker.terminate();
      };
      fileInput.click();
    };

    // ==== XUáº¤T FILE ====
    exportBtn.onclick = () => {
      const csv = transactions.map(t => `${t.date},${t.type},${t.category},${t.amount},${t.note}`).join("\n");
      const blob = new Blob(["NgÃ y,Loáº¡i,Má»¥c,Sá»‘ tiá»n,Ghi chÃº\n" + csv], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "VieMoney.csv";
      link.click();
    };

  </script>

  <!-- Chart.js & Tesseract -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

</body>
</html>
